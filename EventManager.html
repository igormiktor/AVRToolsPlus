<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AVRToolsPlus: EventManager</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AVRToolsPlus
   </div>
   <div id="projectbrief">A library wof higher-level tools for AVR ATmega328 and ATmega2560 Microcontrollers</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title"><a class="el" href="namespaceEventManager.html" title="This namespace bundles the Event Manager functionality. It provides logical cohesion for functions im...">EventManager</a> </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Using an event-driven design is a common way to code AVR projects that interact with the environment around them. With <a class="el" href="namespaceEventManager.html" title="This namespace bundles the Event Manager functionality. It provides logical cohesion for functions im...">EventManager</a> you register functions that "listen" for particular events. When things happen you "post" events to <a class="el" href="namespaceEventManager.html" title="This namespace bundles the Event Manager functionality. It provides logical cohesion for functions im...">EventManager</a>. You then periodically call an <a class="el" href="namespaceEventManager.html" title="This namespace bundles the Event Manager functionality. It provides logical cohesion for functions im...">EventManager</a> function which processes events by dispatching them so that he appropriate listeners are called.</p>
<p>EventManger is interrupt safe, so that you can post events from interrupt handlers. The corresponding listeners will be called from outside the interrupt handler in your main thread of execution when you call the <a class="el" href="namespaceEventManager.html" title="This namespace bundles the Event Manager functionality. It provides logical cohesion for functions im...">EventManager</a> function to process events.</p>
<p>In keeping with the limited resources of an AVR system, <a class="el" href="namespaceEventManager.html" title="This namespace bundles the Event Manager functionality. It provides logical cohesion for functions im...">EventManager</a> is light-weight. There is no dynamic memory allocation. Event queuing is very fast, so you can be comfortable queuing events from interrupt handlers. To keep the footprint minimal, the event queue and the listener list (also known as the dispatch table) are both small (although you can make them bigger if needed).</p>
<p><a class="el" href="namespaceEventManager.html" title="This namespace bundles the Event Manager functionality. It provides logical cohesion for functions im...">EventManager</a> supports both high priority and low priority events, and will process high priority events ahead of any low priority events.</p>
<p><a class="el" href="namespaceEventManager.html" title="This namespace bundles the Event Manager functionality. It provides logical cohesion for functions im...">EventManager</a> is implemented as a set of functions contained with the namespace <a class="el" href="namespaceEventManager.html" title="This namespace bundles the Event Manager functionality. It provides logical cohesion for functions im...">EventManager</a>. Implementing <a class="el" href="namespaceEventManager.html" title="This namespace bundles the Event Manager functionality. It provides logical cohesion for functions im...">EventManager</a> this was instead of as a class removes the need to create and share an <a class="el" href="namespaceEventManager.html" title="This namespace bundles the Event Manager functionality. It provides logical cohesion for functions im...">EventManager</a> object across your code. However, it does limit your code to a single <a class="el" href="namespaceEventManager.html" title="This namespace bundles the Event Manager functionality. It provides logical cohesion for functions im...">EventManager</a> and therefore a single set of event queues.</p>
<h1><a class="anchor" id="EventManagerUsage"></a>
Usage</h1>
<p>Using <a class="el" href="namespaceEventManager.html" title="This namespace bundles the Event Manager functionality. It provides logical cohesion for functions im...">EventManager</a> is straightforward. You include <a class="el" href="EventManager_8h.html" title="This file provides an Event Manager using functional interface under the namespace EventManager...">EventManager.h</a> in files that access the <a class="el" href="namespaceEventManager.html" title="This namespace bundles the Event Manager functionality. It provides logical cohesion for functions im...">EventManager</a> and link against the file <code>EventManager.cpp</code>. You register listener functions using <a class="el" href="namespaceEventManager.html#ac41df6e7881b1ed01dbbe9e2147e441a" title="Add an (event, listener) pair listener to the dispatch table. ">EventManager::addListener()</a>, you post events using <a class="el" href="namespaceEventManager.html#ad2877b920fcf9281fa6fba35e449354a" title="Tries to add an event into the event queue. ">EventManager::queueEvent()</a>, and you process events by calling <a class="el" href="namespaceEventManager.html#af38c3f10221bdb1f0f54fb31d8530e99" title="Processes one event from the event queue and dispatches it to the corresponding listeners stored in t...">EventManager::processEvent()</a>.</p>
<p>The following sections explain this in more detail.</p>
<h1><a class="anchor" id="EventManagerEvents"></a>
Events</h1>
<p><a class="el" href="namespaceEventManager.html" title="This namespace bundles the Event Manager functionality. It provides logical cohesion for functions im...">EventManager</a> events consist of an event code and an event parameter. Both of these are integer values. The event code identifies the type of event. For convenience, <a class="el" href="EventManager_8h.html" title="This file provides an Event Manager using functional interface under the namespace EventManager...">EventManager.h</a> provides a set of constants you can use to identify events:</p>
<div class="fragment"><div class="line">EventManager::kEventKeyPress</div><div class="line">EventManager::kEventKeyRelease</div><div class="line">EventManager::kEventChar</div><div class="line">EventManager::kEventTime</div><div class="line">EventManager::kEventTimer0</div><div class="line">EventManager::kEventTimer1</div><div class="line">EventManager::kEventTimer2</div><div class="line">EventManager::kEventTimer3</div><div class="line">EventManager::kEventAnalog0</div><div class="line">EventManager::kEventAnalog1</div><div class="line">EventManager::kEventAnalog2</div><div class="line">EventManager::kEventAnalog3</div><div class="line">EventManager::kEventAnalog4</div><div class="line">EventManager::kEventAnalog5</div><div class="line">EventManager::kEventMenu0</div><div class="line">EventManager::kEventMenu1</div><div class="line">EventManager::kEventMenu2</div><div class="line">EventManager::kEventMenu3</div><div class="line">EventManager::kEventMenu4</div><div class="line">EventManager::kEventMenu5</div><div class="line">EventManager::kEventMenu6</div><div class="line">EventManager::kEventMenu7</div><div class="line">EventManager::kEventMenu8</div><div class="line">EventManager::kEventMenu9</div><div class="line">EventManager::kEventSerial</div><div class="line">EventManager::kEventPaint</div><div class="line">EventManager::kEventUser0</div><div class="line">EventManager::kEventUser1</div><div class="line">EventManager::kEventUser2</div><div class="line">EventManager::kEventUser3</div><div class="line">EventManager::kEventUser4</div><div class="line">EventManager::kEventUser5</div><div class="line">EventManager::kEventUser6</div><div class="line">EventManager::kEventUser7</div><div class="line">EventManager::kEventUser8</div><div class="line">EventManager::kEventUser9</div></div><!-- fragment --><p>These are purely for your convenience; <a class="el" href="namespaceEventManager.html" title="This namespace bundles the Event Manager functionality. It provides logical cohesion for functions im...">EventManager</a> only uses the numerical value to match events to listeners, so you are free to use any event codes you wish.</p>
<p>The event parameter is also whatever you want it to be. <a class="el" href="namespaceEventManager.html" title="This namespace bundles the Event Manager functionality. It provides logical cohesion for functions im...">EventManager</a> simply passes the event parameter to every listener function that is associated with that event code. For example, for a key press event the event parameter could be the corresponding key code. For an analog event it could be the value read from that analog pin or a pin number.</p>
<p>You post events using the <a class="el" href="namespaceEventManager.html#ad2877b920fcf9281fa6fba35e449354a" title="Tries to add an event into the event queue. ">EventManager::queueEvent()</a> function, like this:</p>
<div class="fragment"><div class="line"><a class="code" href="namespaceEventManager.html#ad2877b920fcf9281fa6fba35e449354a">EventManager::queueEvent</a>( EventManager::kEventUser0, 1234 );</div></div><!-- fragment --><p>The <a class="el" href="namespaceEventManager.html#ad2877b920fcf9281fa6fba35e449354a" title="Tries to add an event into the event queue. ">EventManager::queueEvent()</a> function is lightweight and interrupt safe, so you can call it from inside an interrupt handler.</p>
<p>By default the event queue holds 8 events, but you can make the event queue any size you want by defining the macro EVENTMANAGER_EVENT_QUEUE_SIZE to whatever value you desire (see <a href="##EventManagerIncreaseQueueListSize">Increasing Event Queue Size</a> below).</p>
<h1><a class="anchor" id="EventManagerListeners"></a>
Listeners</h1>
<p>Listeners are functions of type</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> void ( *<a class="code" href="namespaceEventManager.html#acc01765cbb98446a9b4f5d969526bef6">EventListener</a> )( <span class="keywordtype">int</span> eventCode, <span class="keywordtype">int</span> eventParam );</div></div><!-- fragment --><p>You add listeners using the <a class="el" href="namespaceEventManager.html#ac41df6e7881b1ed01dbbe9e2147e441a" title="Add an (event, listener) pair listener to the dispatch table. ">EventManager::addListener()</a> function, like this:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> myListener( <span class="keywordtype">int</span> eventCode, <span class="keywordtype">int</span> eventParam )</div><div class="line">{</div><div class="line">    <span class="comment">// Do something with the event</span></div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> setup()</div><div class="line">{</div><div class="line">    <a class="code" href="namespaceEventManager.html#ac41df6e7881b1ed01dbbe9e2147e441a">EVentManager::addListener</a>( EventManager::kEventUser0, myListener );</div><div class="line"></div><div class="line">    <span class="comment">// Do more set up</span></div><div class="line">}</div></div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>Do <em>not</em> add listeners from within an interrupt routine.</dd></dl>
<p>By default the list of listeners holds 8 listeners, but you can make the list any size you want by defining the macro EVENTMANAGER_DISPATCH_TABLE_SIZE to whatever value you desire (see <a href="##EventManagerIncreaseListenerListSize">Increasing Listener List Size</a> below).</p>
<h1><a class="anchor" id="EventManagerProcessEvents"></a>
Processing Events</h1>
<p>To process events in the event queue and dispatch them to listeners you call <a class="el" href="namespaceEventManager.html#af38c3f10221bdb1f0f54fb31d8530e99" title="Processes one event from the event queue and dispatches it to the corresponding listeners stored in t...">EventManager::processEvent()</a> from a top-level event handling loop:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> loop()</div><div class="line">{</div><div class="line">    <span class="comment">// Do stuff that might generate events</span></div><div class="line"></div><div class="line">    <span class="comment">// Process events</span></div><div class="line">    <a class="code" href="namespaceEventManager.html#af38c3f10221bdb1f0f54fb31d8530e99">EventManager::processEvent</a>();</div><div class="line">}</div></div><!-- fragment --><p>This call processes one event from the event queue every time it is called. Usually <a class="el" href="namespaceEventManager.html#af38c3f10221bdb1f0f54fb31d8530e99" title="Processes one event from the event queue and dispatches it to the corresponding listeners stored in t...">EventManager::processEvent()</a> is called once in the inside of some main event loop so that one event is handled every time through the loop. This is usually more than adequate to keep up with incoming events. Events are normally processed in a first-in, first-out fashion (but see the section on <a href="#EventManagerEventPriority">Event Priority</a> below).</p>
<h1><a class="anchor" id="EventManagerAdvancedTopics"></a>
Advanced Details</h1>
<p>The remaining sections provide additional details about Event Manager that allowed more tailor and flexible usage.</p>
<h2><a class="anchor" id="EventManagerEventPriority"></a>
Event Priority</h2>
<p><a class="el" href="namespaceEventManager.html" title="This namespace bundles the Event Manager functionality. It provides logical cohesion for functions im...">EventManager</a> recognizes high and low priority events. You can specify the priority when you queue the event. By default, events are considered low priority. You indicate an event is high priority by passing an additional constant to <a class="el" href="namespaceEventManager.html#ad2877b920fcf9281fa6fba35e449354a" title="Tries to add an event into the event queue. ">EventManager::queueEvent()</a>, like so:</p>
<div class="fragment"><div class="line"><a class="code" href="namespaceEventManager.html#ad2877b920fcf9281fa6fba35e449354a">EventManager::queueEvent</a>( EventManager::kEventUser0, 1234, EventManager::kHighPriority );</div></div><!-- fragment --><p>The difference between high and low priority events is that <a class="el" href="namespaceEventManager.html#af38c3f10221bdb1f0f54fb31d8530e99" title="Processes one event from the event queue and dispatches it to the corresponding listeners stored in t...">EventManager::processEvent()</a> will process a high priority event ahead of any low priority events. In effect, high priority events jump to the front of the queue (multiple high priority events are processed first-in, first-out, but all of them are processed before any low priority events).</p>
<dl class="section note"><dt>Note</dt><dd>If high priority events are queued faster than low priority events, <a class="el" href="namespaceEventManager.html" title="This namespace bundles the Event Manager functionality. It provides logical cohesion for functions im...">EventManager</a> may never get to processing any of the low priority events. So use high priority events judiciously.</dd></dl>
<h2><a class="anchor" id="EventManagerInterruptSafety"></a>
Interrupt Safety</h2>
<p><a class="el" href="namespaceEventManager.html" title="This namespace bundles the Event Manager functionality. It provides logical cohesion for functions im...">EventManager</a> is interrupt safe, so that you can queue events both from within interrupt handlers and also from normal functions without having to worry about queue corruption. This safety is achieved by globally disabling interrupts while certain small snippets of code are executing.</p>
<h2><a class="anchor" id="EventManagerProcessAllEvents"></a>
Processing All Events</h2>
<p>Normally calling <a class="el" href="namespaceEventManager.html#af38c3f10221bdb1f0f54fb31d8530e99" title="Processes one event from the event queue and dispatches it to the corresponding listeners stored in t...">EventManager::processEvent()</a> once every time through a top-level event processing loop is more than adequate to service incoming events. However, there may be times when you want to process all the events in the queue. For this purpose you can call <a class="el" href="namespaceEventManager.html#a05dc715206be6b72b7de0c392303026b" title="Processes all the events in the event queues and dispatches them to the corresponding listeners store...">EventManager::processAllEvents()</a>. Note that if you call this function at the same time that a series of events are being rapidly added to the queue asynchronously (for example, via interrupt handlers), the <a class="el" href="namespaceEventManager.html#a05dc715206be6b72b7de0c392303026b" title="Processes all the events in the event queues and dispatches them to the corresponding listeners store...">EventManager::processAllEvents()</a> function might not return until the series of additions to the event queue stops.</p>
<h2><a class="anchor" id="EventManagerIncreaseEventQueueSize"></a>
Increasing Event Queue Size</h2>
<p>Define the macro <code>EVENTMANAGER_EVENT_QUEUE_SIZE</code> to whatever size you need at compile time by passing it to the compiler on the command line using something like: <code>-DEVENTMANAGER_EVENT_QUEUE_SIZE=32</code></p>
<p>The event queue requires <code>4 * sizeof(int) = 8</code> bytes for each unit of size. There is a factor of 4 (instead of 2) because internally <a class="el" href="namespaceEventManager.html" title="This namespace bundles the Event Manager functionality. It provides logical cohesion for functions im...">EventManager</a> maintains two separate queues: a high-priority queue and a low-priority queue.</p>
<h2><a class="anchor" id="EventManagerIncreaseListenerListSize"></a>
Increasing Listener List Size</h2>
<p>Define the macro <code>EVENTMANAGER_LISTENER_LIST_SIZE</code> to whatever size you need at compile time by passing it to the compiler on the command line using something like: : <code>-DEVENTMANAGER_LISTENER_LIST_SIZE=32</code></p>
<p>The listener list requires <code>sizeof(*f()) + sizeof(int) + sizeof(boolean) = 5</code> bytes for each unit of size.</p>
<h2><a class="anchor" id="EventManagerAdditionalFeatures"></a>
Additional Features</h2>
<p>There are various functions for managing the listeners:</p>
<ul>
<li>You can remove listeners using <a class="el" href="namespaceEventManager.html#a948a9b6c9972fe43bd1907e232f58371" title="Remove this (event, listener) pair from the dispatch table. Other listener pairs with the same functi...">EventManager::removeListener()</a></li>
<li>Disable and enable specific listeners using <a class="el" href="namespaceEventManager.html#a49333be1ca883c886fd0fc6ed65c751c" title="Enable or disable an (event, listener) pair entry in the dispatch table. ">EventManager::enableListener()</a></li>
<li>Set a default listener using <a class="el" href="namespaceEventManager.html#a36ffab7bf2abc99ea9608fd700ede578" title="Set a default listener. The default listener is a callback function that is called when an event with...">EventManager::setDefaultListener()</a>; the default listener will handle any events not handled by other listeners</li>
<li>Manipulate the default listener just like any other listener using <a class="el" href="namespaceEventManager.html#a25f62948105d7ceeee4247b4d46803e8" title="Remvoes the default listener. The default listener is a callback function that is called when an even...">EventManager::removeDefaultListener()</a> and <a class="el" href="namespaceEventManager.html#a00db80ac42ed2717a2928c77fd0773bb" title="Enable or disable the default listener. The default listener is a callback function that is called wh...">EventManager::enableDefaultListener()</a></li>
<li>Check if the listener list is full using <a class="el" href="namespaceEventManager.html#a9f1361e3874fc22f97d05d38509e40c6" title="Check if the listener list (a.k.a., dispatch table) is full. ">EventManager::isListenerListFull()</a></li>
<li>Check if the listener list is empty using <a class="el" href="namespaceEventManager.html#a18f6e971ba7fa76fd093f0c8ad9e8e62" title="Check if the listener list (a.k.a., dispatch table) is empty. ">EventManager::isListenerListEmpty()</a></li>
</ul>
<p>There are various class functions that provide information about the event queue:</p>
<ul>
<li>Check if the event queue is full using <a class="el" href="namespaceEventManager.html#a8c38d45226c44ac626c93a0e956b3103" title="Check if the event queue is full. ">EventManager::isEventQueueFull()</a></li>
<li>Check if the event queue is empty using <a class="el" href="namespaceEventManager.html#a003ec052ae2933a35354649813ca35b5" title="Check if the event queue is empty. ">EventManager::isEventQueueEmpty()</a></li>
<li>See how many events are in the event queue using <a class="el" href="namespaceEventManager.html#aa6289cc59533ecee7a9faa058048e884" title="Get the number of events in the event queue. ">EventManager::getNumEventsInQueue()</a></li>
</ul>
<p>For details on these functions you should review <a class="el" href="EventManager_8h.html" title="This file provides an Event Manager using functional interface under the namespace EventManager...">EventManager.h</a> documentation.</p>
<h2><a class="anchor" id="EventManagerCredits"></a>
Credits</h2>
<p><a class="el" href="namespaceEventManager.html" title="This namespace bundles the Event Manager functionality. It provides logical cohesion for functions im...">EventManager</a> was inspired by the Arduino Event System by <a href="#" onclick="location.href='mai'+'lto:'+'mro'+'ma'+'ni@'+'ot'+'tot'+'ec'+'nic'+'a.'+'com'; return false;">mroma<span style="display: none;">.nosp@m.</span>ni@o<span style="display: none;">.nosp@m.</span>ttote<span style="display: none;">.nosp@m.</span>cnic<span style="display: none;">.nosp@m.</span>a.com</a> of OTTOTECNICA Italy. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Feb 19 2017 21:17:35 for AVRToolsPlus by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
